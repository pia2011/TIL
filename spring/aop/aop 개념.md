# 스프링 AOP 개념

## AOP 소개 - 핵심기능과 부가 기능

### 핵심기능과 부가기능

애플리케이션 로직은 크게 핵심 기능과 부가 기능으로 나눌 수 있다.

- 핵심기능
> 해당 객체가 제공하는 고유의 기능

예를 들어 우리가 잘 알다싶이 OrderService의 핵심 기능은 주문 로직이다.

- 부가기능
> 핵심 기능을 보조하기 위해 제공되는 기능

부가기능은 단독으로 사용되지 않고, 핵심기능과 함께 사용되며 핵심 기능을 보조하는 기능이다.
예를 들어 **로그 추적 기능**, **트랜잭션 기능** 등이 있다.

<img width="894" alt="image" src="https://user-images.githubusercontent.com/53935439/208285340-ef8c2512-9eb0-4fc2-ba5c-2f4579a249e9.png">

주문 로직이 실행하기 직전에 로그 추적 기능을 사용해야 하면, 핵심 기능인 주문 로직과 부가 기능인 로그 추적 로직이 하나의 객체 안에 섞여 들어가게 된다.
부가 기능이 필요한 경우 이렇게 둘을 합쳐 하나의 로직을 완성한다.

이제 주문 서비스(OrderService)를 실행하면 핵심기능인 주문 로직과 부가 기능인 로그 추적 로직이 함께 실행된다.

### 여러 곳에서 공통으로 사용하는 부가 기능

<img width="912" alt="image" src="https://user-images.githubusercontent.com/53935439/208285540-2f0258c8-86e0-4522-b30f-5a08a0869f1b.png">

보통 부가 기능은 여러 클래스에 걸쳐서 함께 사용된다. 예를 들어 모든 애플리케이션 호출을 로깅해야 하는 요구의 경우, 이러한 부가 기능은 **횡단 관심사**가 된다.

쉽게 이야기 하자면 하나의 부가 기능이 **여러 곳에서 동일하게 사용된다**는 뜻이다.

### 부가 기능 적용 문제

- 부가 기능을 적용할 때 아주 많은 반복이 필요하다.
- 부가 기능이 여러 곳에 퍼져서 중복 코드를 만들어낸다. 
- 부가 기능을 변경할 때 중복 때문에 많은 수정이 필요하다. 
- 부가 기능의 적용 대상을 변경할 때 많은 수정이 필요하다.

하지만 이런 부가 기능을 여러 곳에 적용하는 것은 너무 번거롭다. 예를 들어 부가 기능을 적용해야 하는 클래스가 100개면 100개 모두에 동일한 코드를 추가해야 한다.

부가 기능을 별도의 유틸리티 클래스로 만든다고 해도, 해당 유틸리티 클래스를 호출하는 코드가 결국 필요하다.
그리고 부가 기능이 구조적으로 단순 호출이 아닌 try~catch~finally 같은 구조가 필요하다면 더욱 더 복잡해진다.

더 큰 문제는 수정이다. 부가 기능에 수정이 발생하면, 100개의 클래스 모두를 하나씩 찾아가면서 수정해야 한다. 즉 수 많은 코드를 고쳐야 한다.

소프트웨어 개발에서 변경 지점은 하나가 될 수 있도록 잘 모듈화 해야한다. 그런데 부가 기능처럼 특정 로직을 애플리케이션 전반에 적용하는 문제는 
> 결국 일반적인 OOP 방식으로는 해결이 어렵다.


## AOP 소개 - Aspect

### 핵심 기능과 부가 기능을 분리

이러한 부가 기능 도입의 문제를 해결하기 위해 등장한 방법이 
- 부가 기능을 핵심 기능에서 분리하고 한 곳에서 관리하도록 하는 방법이다.
- 그리고 해당 부가 기능을 어디에 적용할지 선택하는 기능도 만들었다.

이렇게 부가 기능과 부가 기능을 어디에 적용할지 선택하는 기능을 합해서 하나의 모듈로 만든 것이 바로 Aspect이다.

쉽게 말해 부가 기능과 해당 부가 기능을 어디에 적용할지 정의한 것이다. 

예를 들어 로그 출력 기능을 모든 컨트롤러에 적용하라 라는 것이 정의되어있다.

에스펙트는 우리 말로 해석하자면 관점이라는 뜻인데, 이름 그대로 애플리케이션을 바라보는 관점을 하나하나의 기능에서 횡단 관심사 관점으로 다르게 보는 것이다.

> 참고로 AOP는 OOP를 대체하기 위한 것이 아니라 횡단 관심사를 깔끔하게 처리하기 어려운 OOP의 부족한 부분을 보조하는 목적으로 개발되었다.

<img width="896" alt="image" src="https://user-images.githubusercontent.com/53935439/208290053-b4996525-4c9b-4af2-91b9-54f53f888691.png">

<img width="900" alt="image" src="https://user-images.githubusercontent.com/53935439/208290092-47340f1c-ef5e-451d-96a5-fbce04db8783.png">

### AspectJ 프레임워크

AOP의 대표적인 구현으로 AspectJ 프레임워크가 있다. 

스프링 또한 AOP를 지원하지만 대부분 AspectJ 문법을 차용하고, AspectJ 가 제공하는 일부의 기능만 제공한다.

AspectJ 프레임워크는 스스로를 다음과 같이 설명한다. 

- 자바 프로그래밍 언어에 대한 완벽한 관점 지향 확장 
- 횡단 관심사의 깔끔한 모듈화 
  - 오류 검사 및 처리 
  - 동기화
  - 성능 최적화(캐싱) 
  - 모니터링 및 로깅

## AOP 적용 방식