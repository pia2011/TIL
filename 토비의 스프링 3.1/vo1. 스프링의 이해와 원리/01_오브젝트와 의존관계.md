# 오브젝트와 의존관계

1장에서는 스프링이 관심을 갖는 대상인 오브젝트의 설계와 구현, 동작원리에 더 집중한다.
그렇게 하다보면 자연스럽게 스프링이 무엇인지도 이해될 것이다.

### 1.1 초난감 DAO


우리는 DAO로 원하는 정보를 JDBC API를 통해 DB에 저장하고 조회할 수 있다.

  ```
  DAO(Data Access Object)는 DB를 사용해 데이터를 조회하거나 조작하는 기능을 
  전담하도록 만든 오브젝트를 말한다.
  ```

그리고 그 정보를 저장할 때에는 자바빈 규약을 따라는 오브젝트를 이용하면 편리하다.

  ```
  자바빈(JavaBean)은 간단하게 빈이라고도 불리우며 다음의 두가지 관례를 따라 만들어진
  오브젝트를 가리킨다.
  - 디폴트 생성자(파라미터가 없는 생성자)를 갖고 있어야 한다. 툴이나 프레임워크에서 리플렉션을
  이용해서 오브젝트를 생성하기 때문이다.
  - 자바빈이 노출하는 이름을 가진 속성을 프로퍼티라고 부르는데, 수정자 메소드(setter)와
  접근자 메소드(getter)를 이용해서 수정 또는 조회할 수 있다.
  ```

```
package springbook.user.domain;

public class User {
	String id;
	String name;
	String password;
	
	public String getId() {
		return id;
	}
	public void setId(String id) {
		this.id = id;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public String getPassword() {
		return password;
	}
	public void setPassword(String password) {
		this.password = password;
	}
}
```

JDBC를 이용하는 작업의 일반적인 순서는 다음과 같다.

1. DB연결을 위한 Connection을 가져온다.
2. SQL을 담은 Statement를 만든다.
3. 만들어진 Statement를 실행한다.
4. 조회의 경우 SQL쿼리의 실행 결과를 ResultSet으로 받아서 정보를 저장할 오브젝트에 옮겨준다.
5. 작업 중에 생성된 리소스는 작업을 마친 후 반드시 닫아준다.
6. JDBC API가 만들어내는 예외를 잡아서 직접 처리하거나, 메소드에 throws를 선언해서 예외가 발생하면 메소드 밖으로 던지게 한다.

```
package springbook.user.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import springbook.user.domain.User;

public class UserDao {
	public void add(User user) throws ClassNotFoundException, SQLException {
		Class.forName("com.mysql.jdbc.Driver");
		Connection c = DriverManager.getConnection("jdbc:mysql://localhost/springbook?characterEncoding=UTF-8", "spring",
				"book");

		PreparedStatement ps = c.prepareStatement(
			"insert into users(id, name, password) values(?,?,?)");
		ps.setString(1, user.getId());
		ps.setString(2, user.getName());
		ps.setString(3, user.getPassword());

		ps.executeUpdate();

		ps.close();
		c.close();
	}


	public User get(String id) throws ClassNotFoundException, SQLException {
		Class.forName("com.mysql.jdbc.Driver");
		Connection c = DriverManager.getConnection("jdbc:mysql://localhost/springbook?characterEncoding=UTF-8", "spring",
				"book");
		PreparedStatement ps = c
				.prepareStatement("select * from users where id = ?");
		ps.setString(1, id);

		ResultSet rs = ps.executeQuery();
		rs.next();
		User user = new User();
		user.setId(rs.getString("id"));
		user.setName(rs.getString("name"));
		user.setPassword(rs.getString("password"));

		rs.close();
		ps.close();
		c.close();

		return user;
	}

	public static void main(String[] args) throws ClassNotFoundException, SQLException {
		UserDao dao = new UserDao();

		User user = new User();
		user.setId("whiteship");
		user.setName("백기선");
		user.setPassword("married");

		dao.add(user);
			
		System.out.println(user.getId() + " 등록 성공");
		
		User user2 = dao.get(user.getId());
		System.out.println(user2.getName());
		System.out.println(user2.getPassword());
			
		System.out.println(user2.getId() + " 조회 성공");
	}

}
```

위와 같이 만들어진 코드의 기능을 검증하고자 할 때 사용할 수 있는 가장 간단한 방법은 오브젝트 스스로 자신을
검증하게 만들어 주는 것이다. main() 메소드를 만들고 그 안에 오브젝트를 생성해서 getter와 setter 메소드를 이요해서
검증해 볼 수 있다. 물론 사용할 DB의 드라이버가 클래스패스에 있어야 하는 것도 잊지 말아야 한다.

이렇게 해서 사용자 정보의 등록과 조회가 되는 초간단 DAO와 테스트용 메소드까지 완성했다. 하지만 위 코드에서는 여러가지 문제가 있다.
그리고 앞으로 그 해결방법에 대해 학습할 것이다.

### 1.2 DAO 분리